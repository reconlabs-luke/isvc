name: plicar cicd

on:
  push:
    branches: 
      - "master"
      - "release"
      - "develop"

jobs:
  push-to-subtree:
    name: Push to subtree repository
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v2
      - name: Push to subtree
        env:
          ACCESS_TOKEN: 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
          SUBTREE_REPO_NAME: sdfstudio
          SUBTREE_NAME: sub
        run : |
          git config --global user.name reconlabs-luke
          git config --global user.email luke@reconlabs.ai
          GITHUB_URL="https://${ACCESS_TOKEN}@github.com/reconlabs-luke/${SUBTREE_REPO_NAME}.git"
          echo $ID && echo $PASSWD && echo $GITHUB_URL
          git remote add ${SUBTREE_NAME} ${GITHUB_URL}
          git subtree push --prefix ${SUBTREE_REPO_NAME} ${SUBTREE_NAME} ${GITHUB_REF_NAME}
